import{c as Y,r,j as t,L as ue,X as qe,S as V,C as he,a as xe,Z as Ve,d as Ze}from"./index-xVOWz0mX.js";import{p as me,Z as _e}from"./pdf-DZ-qPoKq.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=Y("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=Y("FileSearch",[["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M4.268 21a2 2 0 0 0 1.727 1H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"ms7g94"}],["path",{d:"m9 18-1.5-1.5",key:"1j6qii"}],["circle",{cx:"5",cy:"14",r:"3",key:"ufru5t"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=Y("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=Y("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);me.GlobalWorkerOptions.workerSrc="//cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";const Z=[{name:"Rojo",value:"rgba(239, 68, 68, 0.4)",border:"#ef4444"},{name:"Azul",value:"rgba(59, 130, 246, 0.4)",border:"#3b82f6"},{name:"Verde",value:"rgba(34, 197, 94, 0.4)",border:"#22c55e"},{name:"Amarillo",value:"rgba(234, 179, 8, 0.4)",border:"#eab308"},{name:"Morado",value:"rgba(168, 85, 247, 0.4)",border:"#a855f7"},{name:"Naranja",value:"rgba(249, 115, 22, 0.4)",border:"#f97316"}],_=.3,H=3,X=.15;function et({pdfUrl:$,repuestoDescripcion:pe,existingMarker:o,onSave:fe,onCancel:G,repuestos:M=[],onSelectRepuesto:U}){var ie,de;const y=r.useRef(null),l=r.useRef(null),ye=r.useRef(null),[x,be]=r.useState(null),[b,j]=r.useState((o==null?void 0:o.pagina)||1),[P,we]=r.useState(0),[m,D]=r.useState(1),[je,z]=r.useState(!0),[v,J]=r.useState((o==null?void 0:o.forma)||"rectangulo"),[E,ve]=r.useState((o==null?void 0:o.color)||Z[0].value),[K,Ne]=r.useState(Z[0].border),[Q,B]=r.useState(!1),[g,T]=r.useState(null),[i,w]=r.useState(null),[p,Ce]=r.useState((o==null?void 0:o.sinBorde)!==!0),[L,ee]=r.useState(""),[R,te]=r.useState([]),[Se,k]=r.useState(!1),[O,I]=r.useState(-1),[N,Pe]=r.useState(""),[d,se]=r.useState([]),[W,ae]=r.useState(!1),[C,q]=r.useState(-1),[A,re]=r.useState("repuesto"),[Re,Me]=r.useState(pe);r.useEffect(()=>{$&&(z(!0),me.getDocument($).promise.then(e=>{be(e),we(e.numPages),z(!1)}).catch(e=>{console.error("Error al cargar PDF:",e),z(!1)}))},[$]),r.useEffect(()=>{if(!L.trim()||M.length===0){te([]),I(-1);return}const e=L.toLowerCase(),s=M.filter(a=>{var n,c,u,h;return((n=a.codigoSAP)==null?void 0:n.toLowerCase().includes(e))||((c=a.codigoBaader)==null?void 0:c.toLowerCase().includes(e))||((u=a.textoBreve)==null?void 0:u.toLowerCase().includes(e))||((h=a.descripcion)==null?void 0:h.toLowerCase().includes(e))}).slice(0,10);te(s),I(s.length>0?0:-1)},[L,M]);const ne=r.useCallback(async e=>{if(!x||!e.trim()){se([]);return}ae(!0);const s=[],a=e.toLowerCase();try{for(let n=1;n<=x.numPages;n++){const h=(await(await x.getPage(n)).getTextContent()).items.filter(f=>"str"in f).map(f=>f.str).join(" ");if(h.toLowerCase().includes(a)){const f=h.toLowerCase().indexOf(a),Ke=Math.max(0,f-30),Oe=Math.min(h.length,f+e.length+30),We="..."+h.substring(Ke,Oe)+"...";s.push({pageNum:n,text:We})}}}catch(n){console.error("Error buscando en PDF:",n)}se(s),q(s.length>0?0:-1),s.length>0&&j(s[0].pageNum),ae(!1)},[x]),De=()=>{if(d.length===0)return;const e=(C+1)%d.length;q(e),j(d[e].pageNum)},Ee=()=>{if(d.length===0)return;const e=C===0?d.length-1:C-1;q(e),j(d[e].pageNum)},S=r.useCallback(e=>{if(!l.current)return;const s=l.current.getContext("2d");if(s)if(s.clearRect(0,0,l.current.width,l.current.height),s.fillStyle=E,v==="rectangulo")s.fillRect(e.x,e.y,e.width,e.height),p&&(s.strokeStyle=K,s.lineWidth=2,s.strokeRect(e.x,e.y,e.width,e.height));else{const a=e.x+e.width/2,n=e.y+e.height/2,c=Math.abs(e.width)/2,u=Math.abs(e.height)/2;s.beginPath(),s.ellipse(a,n,c,u,0,0,2*Math.PI),s.fill(),p&&(s.strokeStyle=K,s.lineWidth=2,s.stroke())}},[v,E,K,p]),ce=r.useCallback(async e=>{if(!x||!y.current)return;const s=await x.getPage(e),a=y.current,n=a.getContext("2d");if(!n)return;const c=s.getViewport({scale:m});a.height=c.height,a.width=c.width,l.current&&(l.current.height=c.height,l.current.width=c.width),await s.render({canvasContext:n,viewport:c}).promise,i&&S(i)},[x,m,i,S]);r.useEffect(()=>{ce(b)},[b,ce]),r.useEffect(()=>{if(!x||!(o!=null&&o.coordenadas)||!y.current)return;(async()=>{const a=(await x.getPage(o.pagina)).getViewport({scale:m}),{x:n,y:c,width:u,height:h}=o.coordenadas,f=n<=1&&c<=1&&u<=1&&h<=1;w(f?{x:n*a.width,y:c*a.height,width:u*a.width,height:h*a.height}:{x:n*m,y:c*m,width:u*m,height:h*m})})()},[x,m,o]);const Be=e=>{var a;const s=(a=l.current)==null?void 0:a.getBoundingClientRect();s&&(B(!0),T({x:e.clientX-s.left,y:e.clientY-s.top}),w(null))},Te=e=>{if(!Q||!g||!l.current)return;const s=l.current.getBoundingClientRect(),a=e.clientX-s.left,n=e.clientY-s.top,c={x:Math.min(g.x,a),y:Math.min(g.y,n),width:Math.abs(a-g.x),height:Math.abs(n-g.y)};w(c),S(c)},oe=()=>{B(!1),T(null)},Le=e=>{var n;if(e.touches.length!==1)return;const s=e.touches[0],a=(n=l.current)==null?void 0:n.getBoundingClientRect();a&&(B(!0),T({x:s.clientX-a.left,y:s.clientY-a.top}),w(null))},ke=e=>{if(!Q||!g||!l.current||e.touches.length!==1)return;e.preventDefault();const s=e.touches[0],a=l.current.getBoundingClientRect(),n=s.clientX-a.left,c=s.clientY-a.top,u={x:Math.min(g.x,n),y:Math.min(g.y,c),width:Math.abs(n-g.x),height:Math.abs(c-g.y)};w(u),S(u)},Ie=()=>{B(!1),T(null)},Ae=e=>{if(e.ctrlKey||e.metaKey){e.preventDefault();const s=e.deltaY>0?-X:X;D(a=>Math.min(H,Math.max(_,a+s)))}},F=r.useRef(null),Fe=e=>{if(e.touches.length===2){e.preventDefault();const s=Math.hypot(e.touches[1].clientX-e.touches[0].clientX,e.touches[1].clientY-e.touches[0].clientY);if(F.current!==null){const a=(s-F.current)*.005;D(n=>Math.min(H,Math.max(_,n+a)))}F.current=s}},Xe=()=>{F.current=null},Ye=e=>{ve(e.value),Ne(e.border),i&&setTimeout(()=>S(i),0)},le=e=>{if(Me(e.descripcion||e.textoBreve),ee(""),k(!1),w(null),l.current){const s=l.current.getContext("2d");s==null||s.clearRect(0,0,l.current.width,l.current.height)}U&&U(e)},$e=e=>{R.length&&(e.key==="ArrowDown"?(e.preventDefault(),I(s=>s<R.length-1?s+1:s)):e.key==="ArrowUp"?(e.preventDefault(),I(s=>s>0?s-1:s)):e.key==="Enter"&&O>=0?(e.preventDefault(),le(R[O])):e.key==="Escape"&&k(!1))},ze=()=>{if(!i||!y.current)return;const e=y.current.width,s=y.current.height,a={x:i.x/e,y:i.y/s,width:i.width/e,height:i.height/s};fe({pagina:b,coordenadas:a,forma:v,color:E,descripcion:`Marcador en pÃ¡gina ${b}`,sinBorde:!p})};return je?t.jsx("div",{className:"h-full flex items-center justify-center bg-gray-100",children:t.jsx(ue,{className:"w-8 h-8 text-primary-600 animate-spin"})}):t.jsxs("div",{className:"h-full flex flex-col bg-gray-800",children:[t.jsxs("div",{className:"px-4 py-3 bg-gray-900 text-white",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h3",{className:"font-semibold text-lg",children:"Marcar en Manual"}),t.jsx("button",{onClick:G,className:"p-2 rounded hover:bg-gray-700",children:t.jsx(qe,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"flex gap-2 mb-3",children:[t.jsxs("button",{onClick:()=>re("repuesto"),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm transition-colors ${A==="repuesto"?"bg-primary-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:[t.jsx(V,{className:"w-4 h-4"}),"Buscar Repuesto"]}),t.jsxs("button",{onClick:()=>re("pdf"),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm transition-colors ${A==="pdf"?"bg-primary-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:[t.jsx(ge,{className:"w-4 h-4"}),"Buscar en PDF"]})]}),A==="repuesto"&&M.length>0&&t.jsxs("div",{className:"relative mb-2",children:[t.jsxs("div",{className:"relative",children:[t.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),t.jsx("input",{type:"text",value:L,onChange:e=>{ee(e.target.value),k(!0)},onFocus:()=>k(!0),onKeyDown:$e,placeholder:"Buscar por cÃ³digo SAP, Baader o descripciÃ³n...",className:"w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),Se&&R.length>0&&t.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-gray-700 border border-gray-600 rounded-lg shadow-xl max-h-60 overflow-y-auto z-50",children:R.map((e,s)=>{var a;return t.jsxs("button",{onClick:()=>le(e),className:`w-full px-4 py-3 text-left hover:bg-gray-600 flex items-center gap-3 ${s===O?"bg-gray-600":""}`,children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-mono text-xs bg-gray-800 px-2 py-0.5 rounded text-primary-400",children:e.codigoSAP}),e.codigoBaader&&t.jsx("span",{className:"font-mono text-xs text-gray-400",children:e.codigoBaader})]}),t.jsx("p",{className:"text-sm text-gray-300 truncate mt-1",children:e.descripcion||e.textoBreve})]}),((a=e.vinculosManual)==null?void 0:a.length)>0&&t.jsx("span",{className:"text-xs bg-green-600 px-2 py-0.5 rounded text-white",children:"Marcado"})]},e.id)})})]}),A==="pdf"&&t.jsxs("div",{className:"space-y-2 mb-2",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),t.jsx("input",{type:"text",value:N,onChange:e=>Pe(e.target.value),onKeyDown:e=>{e.key==="Enter"&&ne(N)},placeholder:"Buscar texto en el PDF (ej: 200.1234)...",className:"w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),t.jsxs("button",{onClick:()=>ne(N),disabled:W||!N.trim(),className:"px-4 py-2 bg-primary-600 text-white rounded-lg text-sm font-medium hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[W?t.jsx(ue,{className:"w-4 h-4 animate-spin"}):t.jsx(V,{className:"w-4 h-4"}),"Buscar"]})]}),d.length>0&&t.jsxs("div",{className:"bg-gray-700 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("span",{className:"text-sm text-gray-300",children:[d.length," resultado(s) encontrado(s)"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:Ee,className:"p-1 rounded hover:bg-gray-600",children:t.jsx(he,{className:"w-4 h-4"})}),t.jsxs("span",{className:"text-sm",children:[C+1," / ",d.length]}),t.jsx("button",{onClick:De,className:"p-1 rounded hover:bg-gray-600",children:t.jsx(xe,{className:"w-4 h-4"})})]})]}),t.jsxs("div",{className:"text-xs text-gray-400 bg-gray-800 rounded p-2 max-h-16 overflow-y-auto",children:[t.jsxs("span",{className:"text-primary-400",children:["PÃ¡g. ",(ie=d[C])==null?void 0:ie.pageNum,": "]}),(de=d[C])==null?void 0:de.text]})]}),N&&!W&&d.length===0&&t.jsxs("p",{className:"text-sm text-amber-400",children:['No se encontrÃ³ "',N,'" en el PDF. Intenta con otro tÃ©rmino.']})]}),t.jsxs("p",{className:"text-sm text-gray-400 truncate",children:[t.jsx("span",{className:"text-primary-400 font-medium",children:"Marcando:"})," ",Re]})]}),t.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-gray-700 text-white flex-wrap gap-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>j(e=>Math.max(1,e-1)),disabled:b<=1,className:"p-2 rounded hover:bg-gray-600 disabled:opacity-50",children:t.jsx(he,{className:"w-5 h-5"})}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"text-sm",children:"PÃ¡g."}),t.jsx("input",{type:"number",value:b,onChange:e=>{const s=parseInt(e.target.value);isNaN(s)||j(Math.min(P,Math.max(1,s)))},className:"w-12 px-2 py-1 bg-gray-600 rounded text-center text-sm focus:outline-none focus:ring-1 focus:ring-primary-500",min:1,max:P}),t.jsxs("span",{className:"text-sm",children:["/ ",P]})]}),t.jsx("button",{onClick:()=>j(e=>Math.min(P,e+1)),disabled:b>=P,className:"p-2 rounded hover:bg-gray-600 disabled:opacity-50",children:t.jsx(xe,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"flex items-center gap-1 bg-gray-600 rounded p-1",children:[t.jsx("button",{onClick:()=>J("rectangulo"),className:`p-2 rounded ${v==="rectangulo"?"bg-primary-600":"hover:bg-gray-500"}`,children:t.jsx(Ue,{className:"w-5 h-5"})}),t.jsx("button",{onClick:()=>J("circulo"),className:`p-2 rounded ${v==="circulo"?"bg-primary-600":"hover:bg-gray-500"}`,children:t.jsx(He,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Ge,{className:"w-4 h-4 mr-1 text-gray-400"}),Z.map(e=>t.jsx("button",{onClick:()=>Ye(e),className:`w-7 h-7 rounded-full border-2 transition-transform ${E===e.value?"scale-110 border-white":"border-transparent hover:scale-105"}`,style:{backgroundColor:e.border},title:e.name},e.name))]}),t.jsx("button",{onClick:()=>{Ce(!p),i&&setTimeout(()=>S(i),0)},className:`px-3 py-1.5 rounded text-xs font-medium transition-colors ${p?"bg-gray-600 text-white hover:bg-gray-500":"bg-primary-600 text-white hover:bg-primary-700"}`,title:p?"Ocultar borde":"Sin borde (solo relleno)",children:p?"â¬œ Con borde":"ðŸŸ¦ Sin borde"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>D(e=>Math.max(_,e-X)),className:"p-2 rounded hover:bg-gray-600",children:t.jsx(_e,{className:"w-5 h-5"})}),t.jsxs("span",{className:"text-sm w-14 text-center",children:[Math.round(m*100),"%"]}),t.jsx("button",{onClick:()=>D(e=>Math.min(H,e+X)),className:"p-2 rounded hover:bg-gray-600",children:t.jsx(Ve,{className:"w-5 h-5"})})]})]}),t.jsxs("div",{className:"px-4 py-2 bg-primary-600 text-white text-sm flex items-center justify-between flex-wrap gap-2",children:[t.jsxs("span",{children:["Dibuja un ",v==="rectangulo"?"rectÃ¡ngulo":"cÃ­rculo"," sobre el repuesto"]}),t.jsx("span",{className:"text-primary-200 text-xs hidden sm:block",children:"ðŸ’¡ Ctrl+Scroll para zoom"})]}),t.jsx("div",{ref:ye,className:"flex-1 overflow-auto flex items-start justify-center p-4",onWheel:Ae,onTouchMove:Fe,onTouchEnd:Xe,children:t.jsxs("div",{className:"relative inline-block",children:[t.jsx("canvas",{ref:y,className:"bg-white shadow-lg"}),t.jsx("canvas",{ref:l,className:"absolute top-0 left-0",style:{cursor:"crosshair"},onMouseDown:Be,onMouseMove:Te,onMouseUp:oe,onMouseLeave:oe,onTouchStart:Le,onTouchMove:ke,onTouchEnd:Ie})]})}),t.jsxs("div",{className:"px-4 py-3 bg-gray-900 flex items-center justify-between flex-wrap gap-2",children:[t.jsx("p",{className:"text-sm text-gray-400",children:i?"âœ“ Marcador dibujado - Listo para guardar":"Dibuja el marcador en el PDF"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:G,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",children:"Cancelar"}),t.jsxs("button",{onClick:ze,disabled:!i,className:"flex items-center gap-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[t.jsx(Ze,{className:"w-5 h-5"}),"Guardar"]})]})]})]})}export{et as PDFMarkerEditor};
